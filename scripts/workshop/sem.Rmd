---
title: "sem"
output: html_document
date: "2022-12-06"
---

```{r, message = F}
library(here)

library(tidyverse)
library(magrittr)
library(piecewiseSEM)
library(nlme)
library(lmerTest)

comm_data <- readRDS(here("processed_data","comm_data.rds"))
```


cc ~ mean water temp; size ~ mean water temp; prevalence ~ cc + size + mean water temp
```{r}
cc_temp <- glm(cc ~ MeanWaterTempPredC, data = comm_data)
size_temp <- glm(size ~ MeanWaterTempPredC, data = comm_data)
prev_cc <- glm(Prevalence ~ cc + MeanWaterTempPredC + size, data = comm_data)

sem <- psem(cc_temp, size_temp, prev_cc)
```


```{r}
dSep(sem)
summary(sem)
```
Lefcheck example

```{r}
library(devtools) #Install from CRAN if you do not already have
install_github("jslefche/piecewiseSEM")
library(piecewiseSEM)
data(shipley)
```

```{r}
shipley2009.modlist = list(
  lme(DD~lat, random = ~1|site/tree, na.action = na.omit, 
    data = Shipley),
  lme(Date~DD, random = ~1|site/tree, na.action = na.omit, 
    data = Shipley),
  lme(Growth~Date, random = ~1|site/tree, na.action = na.omit, 
    data = Shipley),
  glmer(Live~Growth+(1|site)+(1|tree), 
    family=binomial(link = "logit"), data = shipley2009) )
```

```{r}
sem.fit(shipley2009.modlist, shipley2009)
```

